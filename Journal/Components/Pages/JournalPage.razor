@page "/journal"
@using Journal.Models
@using Journal.Services
@inject JournalService JournalService


<PageTitle>My Journal</PageTitle>

<h1> My Journal</h1>

<div class="journal-container mt-4">
    <h3>New Entry - @(DateTime.Today.ToString("MMMM dd, yyyy"))</h3>
    
    <div class="mt-3">
        <MoodSelector PrimaryMood="@currentEntry.PrimaryMood" 
                      PrimaryMoodChanged="@((value) => currentEntry.PrimaryMood = value)"
                      SecondaryMood="@currentEntry.SecondaryMood1" 
                      SecondaryMoodChanged="@((value) => currentEntry.SecondaryMood1 = value)" />
    </div>
    
    <div class="mt-3">
        <label>Journal Entry</label>
        <textarea class="form-control" 
                  rows="10"
                  placeholder="Write your journal here..."
                  @bind="currentEntry.Content">
        </textarea>
    </div>
    
    <div class="mt-3">
        <TagSelector Tags="@currentEntry.Tags" />
    </div>
    
    <button class="btn btn-primary mt-3" @onclick="SaveEntry"> Save Entry</button>
    
    @if (savedMessage)
    {
        <div class="alert alert-success mt-3"> Entry saved successfully!</div>
    }
</div>

@code {
    private JournalEntry currentEntry = new();
    private bool savedMessage = false;
    
    protected override void OnInitialized()
    {
        var existing = JournalService.GetEntryByDate(DateTime.Today);
        if (existing != null)
        {
            currentEntry = existing;
        }
    }
    
    private async Task SaveEntry()
    {
        try
        {
            JournalService.SaveEntry(currentEntry);
            savedMessage = true;
            StateHasChanged();
            
            // Hide message after 3 seconds
            await Task.Delay(3000);
            savedMessage = false;
            StateHasChanged();
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error saving entry: {ex.Message}");
        }
    }
}